#include <WiFi.h>
#include <WiFiClientSecure.h>
#include <ArduinoHttpClient.h>

// Replace with your network credentials
const char* ssid = "SW-AC5-WIN11";
const char* password = "wexu9061";

// HTTPS server details
const char* serverName = "jsonplaceholder.typicode.com"; // Just the domain
const int serverPort = 443; // Standard HTTPS port

// Root CA certificate for HTTPS
const char* rootCACertificate = \
"-----BEGIN CERTIFICATE-----\n" \
"MIIDpzCCA06gAwIBAgIQdejYjznIYgETZBgOsch3VjAKBggqhkjOPQQDAjA7MQsw\n" \
"CQYDVQQGEwJVUzEeMBwGA1UEChMVR29vZ2xlIFRydXN0IFNlcnZpY2VzMQwwCgYD\n" \
"VQQDEwNXRTEwHhcNMjQwODIwMDcyOTAyWhcNMjQxMTE4MDcyOTAxWjAXMRUwEwYD\n" \
"VQQDEwx0eXBpY29kZS5jb20wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAARsuzL/\n" \
"o7KTI+BvU0j6DSz8qHQxR/E4yH1OjVsz25iWduFMajk1oOooN+DOwSIyk5WyLao/\n" \
"TMSFcsQ/3KFbkcZDo4ICVjCCAlIwDgYDVR0PAQH/BAQDAgeAMBMGA1UdJQQMMAoG\n" \
"CCsGAQUFBwMBMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFPZMW366VYShU4L4QUQy\n" \
"bFL2Cky3MB8GA1UdIwQYMBaAFJB3kjVnxP+ozKnme9mAeXvMk/k4MF4GCCsGAQUF\n" \
"BwEBBFIwUDAnBggrBgEFBQcwAYYbaHR0cDovL28ucGtpLmdvb2cvcy93ZTEvZGVn\n" \
"MCUGCCsGAQUFBzAChhlodHRwOi8vaS5wa2kuZ29vZy93ZTEuY3J0MCcGA1UdEQQg\n" \
"MB6CDHR5cGljb2RlLmNvbYIOKi50eXBpY29kZS5jb20wEwYDVR0gBAwwCjAIBgZn\n" \
"gQwBAgEwNgYDVR0fBC8wLTAroCmgJ4YlaHR0cDovL2MucGtpLmdvb2cvd2UxL1h3\n" \
"N2s5OTVCdlZnLmNybDCCAQUGCisGAQQB1nkCBAIEgfYEgfMA8QB2AO7N0GTV2xrO\n" \
"xVy3nbTNE6Iyh0Z8vOzew1FIWUZxH7WbAAABkW7nYEAAAAQDAEcwRQIgatvQ+qUI\n" \
"OeFGZKsu/Bxbm3cVeD6NcGcAetfETDKIVqoCIQCP9B8ifu3fMTNpsPnOofNZdAh1\n" \
"ra1yFGUlaRjV/btE8AB3AEiw42vapkc0D+VqAvqdMOscUgHLVt0sgdm7v6s52IRz\n" \
"AAABkW7nYGkAAAQDAEgwRgIhAPMk3oDZrcqImM1P5DTlV2g66Fd8vzZuzEwryLHi\n" \
"r5CBAiEAydCWA7AwtLDZzCuGz3erdbOUf9Xtv4CKhdCB56aq4mcwCgYIKoZIzj0E\n" \
"AwIDRwAwRAIgV/8yoUEmOfB9EKqfjcJMOotxY/X2mDDTIjYgTXveyjkCIHCHty68\n" \
"+d9psmRwMhNy6WwGVcU/S/XM+fQxOe/qp2ES\n" \
"-----END CERTIFICATE-----";

WiFiClientSecure wifiClient;

void setup() {
  Serial.begin(115200);

  // Connect to Wi-Fi
  WiFi.begin(ssid, password);
  Serial.print("Connecting to Wi-Fi");
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.print(".");
  }
  Serial.println("Connected to Wi-Fi");

  // Attach the root CA certificate
  wifiClient.setCACert(rootCACertificate);

  // If you want to skip certificate verification, use this (not recommended for production)
  wifiClient.setInsecure();

  // Check if connected to Wi-Fi
  if (WiFi.status() == WL_CONNECTED) {
    HttpClient client = HttpClient(wifiClient, serverName, serverPort);

    String jsonData = "{\"key1\":\"val1\",\"key2\":\"val2\"}";
    
    // Begin the POST request
    Serial.println("Sending POST request to the server...");

    client.beginRequest();
    client.post("/posts"); // Add the endpoint path after the domain
    client.sendHeader("Content-Type", "application/json");
    client.sendHeader("Content-Length", jsonData.length());
    client.beginBody();
    client.print(jsonData);
    client.endRequest();

    // Check the response from the server
    int statusCode = client.responseStatusCode();
    String response = client.responseBody();

    Serial.print("Status code: ");
    Serial.println(statusCode);
    Serial.print("Response: ");
    Serial.println(response);
    
    client.stop();
  } else {
    Serial.println("WiFi not connected");
  }
}

void loop() {
  // Do nothing in the loop
}
